<?php
/**
 * TripSalama - Page Profil Utilisateur
 * Design System Ï† "Moroccan Luxury"
 * @var array $userData
 * @var array|null $vehicle
 * @var array $stats
 */
$user = current_user();
?>

<!-- Profile Header Card -->
<section class="profile-header section">
    <div class="profile-avatar">
        <?php if (!empty($userData['avatar'])): ?>
            <img src="<?= htmlspecialchars($userData['avatar']) ?>" alt="<?= htmlspecialchars($userData['first_name']) ?>">
        <?php else: ?>
            <?= strtoupper(substr($userData['first_name'] ?? 'U', 0, 1)) ?>
        <?php endif; ?>
    </div>
    <h1 class="profile-name"><?= htmlspecialchars($userData['first_name'] . ' ' . $userData['last_name']) ?></h1>
    <p class="profile-role"><?= $user['role'] === 'driver' ? __('auth.driver') : __('auth.passenger') ?></p>
</section>

<!-- Stats Grid -->
<section class="stats-grid section-tight">
    <div class="stat-card">
        <div class="stat-value"><?= (int)($stats['completed'] ?? 0) ?></div>
        <div class="stat-label"><?= __('history.total_rides') ?></div>
    </div>
    <div class="stat-card">
        <div class="stat-value">
            <?php
            $rating = $userData['rating'] ?? 0;
            echo $rating > 0 ? number_format($rating, 1) : '-';
            ?>
        </div>
        <div class="stat-label"><?= __('profile.rating') ?></div>
    </div>
</section>

<!-- Profile Info Card -->
<section class="card section">
    <div class="card-body">
        <h2 class="text-title mb-4"><?= __('profile.title') ?></h2>

        <div class="info-list">
            <div class="info-item">
                <div class="info-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="4" width="20" height="16" rx="2"/>
                        <path d="M22 6l-10 7L2 6"/>
                    </svg>
                </div>
                <div class="info-content">
                    <span class="info-label"><?= __('auth.email') ?></span>
                    <span class="info-value"><?= htmlspecialchars($userData['email']) ?></span>
                </div>
            </div>

            <div class="info-item">
                <div class="info-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/>
                    </svg>
                </div>
                <div class="info-content">
                    <span class="info-label"><?= __('form.phone') ?></span>
                    <span class="info-value"><?= htmlspecialchars($userData['phone'] ?? '-') ?></span>
                </div>
            </div>

            <div class="info-item">
                <div class="info-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                </div>
                <div class="info-content">
                    <span class="info-label"><?= __('profile.member_since') ?></span>
                    <span class="info-value">
                        <?php
                        $date = new DateTime($userData['created_at']);
                        echo $date->format('d/m/Y');
                        ?>
                    </span>
                </div>
            </div>
        </div>
    </div>
</section>

<?php if ($vehicle): ?>
<!-- Vehicle Card -->
<section class="card section">
    <div class="card-body">
        <h2 class="text-title mb-4"><?= __('vehicle.title') ?></h2>

        <div class="flex items-center gap-4">
            <div class="action-icon" style="background: linear-gradient(135deg, var(--color-accent-soft) 0%, var(--gold-100) 100%); color: var(--color-accent);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 17h14v-6h-4l-2-4H9l-2 4H5v6z"/>
                    <circle cx="7.5" cy="17" r="2"/>
                    <circle cx="16.5" cy="17" r="2"/>
                </svg>
            </div>
            <div>
                <div class="text-body font-semibold"><?= htmlspecialchars($vehicle['brand'] . ' ' . $vehicle['model']) ?></div>
                <div class="text-caption"><?= htmlspecialchars($vehicle['color'] . ' - ' . $vehicle['license_plate']) ?></div>
            </div>
        </div>
    </div>
</section>
<?php endif; ?>

<!-- Edit Profile Button -->
<section class="section">
    <a href="<?= base_url('profile/edit') ?>" class="btn btn-secondary btn-block">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
        <?= __('profile.edit') ?>
    </a>
</section>
