<?php
/**
 * TripSalama - Page Profil Utilisateur
 * Design Uber Premium
 * @var array $userData
 * @var array|null $vehicle
 * @var array $stats
 */
$user = current_user();
?>

<style>
    .profile-page {
        padding-bottom: calc(var(--nav-height) + var(--space-8));
    }

    /* Profile Header */
    .profile-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: var(--space-10) var(--space-4);
        background: var(--uber-black);
        color: var(--uber-white);
        text-align: center;
        margin: calc(-1 * var(--space-4));
        margin-bottom: var(--space-4);
    }

    .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: var(--radius-full);
        background: var(--uber-gray-700);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--text-4xl);
        font-weight: var(--font-bold);
        color: var(--uber-white);
        margin-bottom: var(--space-4);
        overflow: hidden;
    }

    .profile-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .profile-name {
        font-size: var(--text-2xl);
        font-weight: var(--font-bold);
        margin-bottom: var(--space-1);
    }

    .profile-role {
        font-size: var(--text-sm);
        color: var(--uber-gray-400);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Stats Grid */
    .profile-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--space-3);
        margin-bottom: var(--space-4);
    }

    .profile-stat {
        background: var(--uber-white);
        border-radius: var(--radius-xl);
        padding: var(--space-4);
        text-align: center;
        box-shadow: var(--shadow-xs);
    }

    .profile-stat-value {
        font-size: var(--text-2xl);
        font-weight: var(--font-bold);
        color: var(--uber-black);
        line-height: 1;
        margin-bottom: var(--space-1);
    }

    .profile-stat-label {
        font-size: var(--text-xs);
        color: var(--uber-gray-500);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Section */
    .profile-section {
        background: var(--uber-white);
        border-radius: var(--radius-xl);
        margin-bottom: var(--space-4);
        overflow: hidden;
        box-shadow: var(--shadow-xs);
    }

    .profile-section-title {
        padding: var(--space-4);
        font-size: var(--text-xs);
        font-weight: var(--font-semibold);
        color: var(--uber-gray-500);
        text-transform: uppercase;
        letter-spacing: 0.08em;
        border-bottom: 1px solid var(--uber-gray-100);
    }

    /* Profile Item */
    .profile-item {
        display: flex;
        align-items: center;
        gap: var(--space-4);
        padding: var(--space-4);
        border-bottom: 1px solid var(--uber-gray-100);
        transition: background 0.2s ease;
        text-decoration: none;
        color: inherit;
    }

    .profile-item:last-child {
        border-bottom: none;
    }

    .profile-item:hover {
        background: var(--uber-gray-50);
    }

    .profile-item-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--uber-gray-100);
        border-radius: var(--radius-lg);
        color: var(--uber-black);
        flex-shrink: 0;
    }

    .profile-item-icon svg {
        width: 24px;
        height: 24px;
    }

    .profile-item-content {
        flex: 1;
        min-width: 0;
    }

    .profile-item-label {
        font-size: var(--text-xs);
        color: var(--uber-gray-500);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 2px;
    }

    .profile-item-value {
        font-size: var(--text-base);
        font-weight: var(--font-medium);
        color: var(--uber-black);
    }

    .profile-item-arrow {
        width: 20px;
        height: 20px;
        color: var(--uber-gray-400);
    }

    /* Action Buttons */
    .profile-actions {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
    }

    .profile-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--space-2);
        padding: var(--space-4);
        font-size: var(--text-base);
        font-weight: var(--font-semibold);
        border: none;
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        width: 100%;
    }

    .profile-btn svg {
        width: 20px;
        height: 20px;
    }

    .profile-btn-primary {
        background: var(--uber-black);
        color: var(--uber-white);
    }

    .profile-btn-primary:hover {
        background: var(--uber-gray-800);
    }

    .profile-btn-danger {
        background: var(--uber-red-soft);
        color: var(--uber-red);
    }

    .profile-btn-danger:hover {
        background: var(--uber-red);
        color: var(--uber-white);
    }

    /* Animation */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .profile-header { animation: fadeInUp 0.4s ease-out; }
    .profile-stats { animation: fadeInUp 0.4s ease-out 0.05s backwards; }
    .profile-section { animation: fadeInUp 0.4s ease-out 0.1s backwards; }
    .profile-actions { animation: fadeInUp 0.4s ease-out 0.15s backwards; }
</style>

<div class="profile-page">
    <!-- Header -->
    <header class="profile-header">
        <div class="profile-avatar">
            <?php if (!empty($userData['avatar'])): ?>
            <img src="<?= htmlspecialchars($userData['avatar']) ?>" alt="<?= htmlspecialchars($userData['first_name']) ?>">
            <?php else: ?>
            <?= strtoupper(substr($userData['first_name'] ?? 'U', 0, 1)) ?>
            <?php endif; ?>
        </div>
        <h1 class="profile-name"><?= htmlspecialchars($userData['first_name'] . ' ' . $userData['last_name']) ?></h1>
        <p class="profile-role"><?= $user['role'] === 'driver' ? __('auth.driver') : __('auth.passenger') ?></p>
    </header>

    <!-- Stats -->
    <section class="profile-stats">
        <div class="profile-stat">
            <div class="profile-stat-value"><?= (int)($stats['completed'] ?? 0) ?></div>
            <div class="profile-stat-label"><?= __('history.total_rides') ?></div>
        </div>
        <div class="profile-stat">
            <div class="profile-stat-value">
                <?php
                $rating = $userData['rating'] ?? 0;
                echo $rating > 0 ? number_format($rating, 1) : '-';
                ?>
            </div>
            <div class="profile-stat-label"><?= __('profile.rating') ?></div>
        </div>
    </section>

    <!-- Personal Info -->
    <section class="profile-section">
        <h2 class="profile-section-title"><?= __('profile.personal_info') ?></h2>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('profile.full_name') ?></div>
                <div class="profile-item-value"><?= htmlspecialchars($userData['first_name'] . ' ' . $userData['last_name']) ?></div>
            </div>
        </div>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="4" width="20" height="16" rx="2"/>
                    <path d="M22 6l-10 7L2 6"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('auth.email') ?></div>
                <div class="profile-item-value"><?= htmlspecialchars($userData['email']) ?></div>
            </div>
        </div>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('form.phone') ?></div>
                <div class="profile-item-value"><?= htmlspecialchars($userData['phone'] ?? '-') ?></div>
            </div>
        </div>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('profile.member_since') ?></div>
                <div class="profile-item-value">
                    <?php
                    $date = new DateTime($userData['created_at']);
                    echo $date->format('d/m/Y');
                    ?>
                </div>
            </div>
        </div>
    </section>

    <?php if ($vehicle): ?>
    <!-- Vehicle -->
    <section class="profile-section">
        <h2 class="profile-section-title"><?= __('vehicle.title') ?></h2>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
                    <path d="M14 3v5h5M16 13H8M16 17H8M10 9H8"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('vehicle.brand') ?></div>
                <div class="profile-item-value"><?= htmlspecialchars($vehicle['brand'] . ' ' . $vehicle['model']) ?></div>
            </div>
        </div>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="1" y="3" width="15" height="13" rx="2" ry="2"/>
                    <path d="M16 8h4a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-4V8z"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('vehicle.plate') ?></div>
                <div class="profile-item-value"><?= htmlspecialchars($vehicle['license_plate']) ?></div>
            </div>
        </div>

        <div class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('vehicle.color') ?></div>
                <div class="profile-item-value"><?= htmlspecialchars($vehicle['color']) ?></div>
            </div>
        </div>
    </section>
    <?php endif; ?>

    <!-- Settings -->
    <section class="profile-section">
        <h2 class="profile-section-title"><?= __('profile.settings') ?></h2>

        <a href="<?= base_url('profile/edit') ?>" class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('profile.edit') ?></div>
                <div class="profile-item-value"><?= __('profile.edit_info') ?></div>
            </div>
            <svg class="profile-item-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
            </svg>
        </a>

        <a href="<?= base_url('profile/password') ?>" class="profile-item">
            <div class="profile-item-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
            </div>
            <div class="profile-item-content">
                <div class="profile-item-label"><?= __('profile.security') ?></div>
                <div class="profile-item-value"><?= __('profile.change_password') ?></div>
            </div>
            <svg class="profile-item-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
            </svg>
        </a>
    </section>

    <!-- Actions -->
    <div class="profile-actions">
        <form action="<?= base_url('logout') ?>" method="POST" style="margin: 0;">
            <?= csrf_field() ?>
            <button type="submit" class="profile-btn profile-btn-danger">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                    <polyline points="16,17 21,12 16,7"/>
                    <line x1="21" y1="12" x2="9" y2="12"/>
                </svg>
                <?= __('nav.logout') ?>
            </button>
        </form>
    </div>
</div>
