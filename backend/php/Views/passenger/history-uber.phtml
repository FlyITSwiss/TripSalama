<?php
/**
 * TripSalama - Ride History
 * Design Uber Premium
 */
?>

<style>
    .history-page {
        padding: var(--space-4);
        padding-bottom: calc(var(--nav-height) + var(--space-8));
    }

    /* Header */
    .history-header {
        margin-bottom: var(--space-6);
    }

    .history-title {
        font-size: var(--text-3xl);
        font-weight: var(--font-bold);
        color: var(--uber-black);
        letter-spacing: -0.02em;
        margin-bottom: var(--space-2);
    }

    .history-subtitle {
        font-size: var(--text-sm);
        color: var(--uber-gray-500);
    }

    /* Stats */
    .history-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-3);
        margin-bottom: var(--space-6);
    }

    .history-stat {
        background: var(--uber-white);
        border-radius: var(--radius-xl);
        padding: var(--space-4);
        text-align: center;
        box-shadow: var(--shadow-sm);
    }

    .history-stat-value {
        font-size: var(--text-2xl);
        font-weight: var(--font-bold);
        color: var(--uber-black);
        line-height: 1;
        margin-bottom: var(--space-1);
    }

    .history-stat-label {
        font-size: 10px;
        color: var(--uber-gray-500);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    /* Ride List */
    .history-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-3);
    }

    /* Ride Card */
    .history-ride {
        display: flex;
        gap: var(--space-4);
        padding: var(--space-4);
        background: var(--uber-white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xs);
        transition: all 0.2s ease;
    }

    .history-ride:hover {
        box-shadow: var(--shadow-sm);
    }

    /* Date Badge */
    .history-ride-date {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-width: 48px;
        padding: var(--space-2);
        background: var(--uber-gray-100);
        border-radius: var(--radius-lg);
        text-align: center;
    }

    .history-ride-day {
        font-size: var(--text-xl);
        font-weight: var(--font-bold);
        color: var(--uber-black);
        line-height: 1;
    }

    .history-ride-month {
        font-size: 10px;
        color: var(--uber-gray-500);
        text-transform: uppercase;
    }

    /* Content */
    .history-ride-content {
        flex: 1;
        min-width: 0;
    }

    .history-ride-route {
        display: flex;
        gap: var(--space-3);
        margin-bottom: var(--space-2);
    }

    .history-ride-dots {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
        padding: var(--space-1) 0;
    }

    .history-ride-dot {
        width: 8px;
        height: 8px;
        border-radius: var(--radius-full);
    }

    .history-ride-dot.pickup {
        background: var(--uber-black);
    }

    .history-ride-dot.dropoff {
        background: transparent;
        border: 2px solid var(--uber-black);
    }

    .history-ride-line {
        width: 1px;
        height: 16px;
        background: var(--uber-gray-300);
    }

    .history-ride-addresses {
        flex: 1;
        min-width: 0;
    }

    .history-ride-address {
        font-size: var(--text-sm);
        color: var(--uber-black);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: var(--space-2);
    }

    .history-ride-address:last-child {
        margin-bottom: 0;
    }

    .history-ride-meta {
        display: flex;
        gap: var(--space-4);
        font-size: var(--text-xs);
        color: var(--uber-gray-500);
    }

    /* Footer */
    .history-ride-footer {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        justify-content: center;
        gap: var(--space-2);
    }

    .history-ride-price {
        font-size: var(--text-lg);
        font-weight: var(--font-bold);
        color: var(--uber-black);
    }

    .history-ride-status {
        padding: var(--space-1) var(--space-2);
        font-size: 10px;
        font-weight: var(--font-semibold);
        border-radius: var(--radius-full);
        text-transform: uppercase;
    }

    .history-ride-status.completed {
        background: var(--uber-green-soft);
        color: var(--uber-green);
    }

    .history-ride-status.cancelled {
        background: var(--uber-red-soft);
        color: var(--uber-red);
    }

    .history-ride-status.pending {
        background: var(--uber-yellow-soft);
        color: #B37B00;
    }

    /* Empty State */
    .history-empty {
        text-align: center;
        padding: var(--space-12) var(--space-6);
        background: var(--uber-white);
        border-radius: var(--radius-xl);
    }

    .history-empty-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto var(--space-6);
        color: var(--uber-gray-300);
    }

    .history-empty-icon svg {
        width: 100%;
        height: 100%;
    }

    .history-empty-title {
        font-size: var(--text-xl);
        font-weight: var(--font-bold);
        color: var(--uber-black);
        margin-bottom: var(--space-2);
    }

    .history-empty-text {
        font-size: var(--text-base);
        color: var(--uber-gray-500);
        margin-bottom: var(--space-6);
    }

    .history-empty-btn {
        display: inline-flex;
        align-items: center;
        gap: var(--space-2);
        padding: var(--space-4) var(--space-6);
        font-size: var(--text-base);
        font-weight: var(--font-semibold);
        color: var(--uber-white);
        background: var(--uber-black);
        border: none;
        border-radius: var(--radius-lg);
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .history-empty-btn:hover {
        background: var(--uber-gray-800);
    }

    .history-empty-btn svg {
        width: 20px;
        height: 20px;
    }

    /* Animation */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .history-header { animation: fadeInUp 0.4s ease-out; }
    .history-stats { animation: fadeInUp 0.4s ease-out 0.1s backwards; }
    .history-list { animation: fadeInUp 0.4s ease-out 0.2s backwards; }
</style>

<div class="history-page">
    <!-- Header -->
    <header class="history-header">
        <h1 class="history-title"><?= __('history.title') ?></h1>
        <p class="history-subtitle"><?= __('history.subtitle') ?></p>
    </header>

    <!-- Stats -->
    <section class="history-stats">
        <div class="history-stat">
            <div class="history-stat-value"><?= $stats['total'] ?? 0 ?></div>
            <div class="history-stat-label"><?= __('history.total_rides') ?></div>
        </div>
        <div class="history-stat">
            <div class="history-stat-value"><?= $stats['completed'] ?? 0 ?></div>
            <div class="history-stat-label"><?= __('history.completed') ?></div>
        </div>
        <div class="history-stat">
            <div class="history-stat-value"><?= number_format($stats['total_spent'] ?? 0) ?></div>
            <div class="history-stat-label"><?= __('history.total_spent') ?></div>
        </div>
    </section>

    <!-- Ride List -->
    <?php if (!empty($rides)): ?>
    <div class="history-list">
        <?php foreach ($rides as $ride):
            $date = new DateTime($ride['created_at']);
            $statusClass = match($ride['status']) {
                'completed' => 'completed',
                'cancelled' => 'cancelled',
                default => 'pending'
            };
        ?>
        <article class="history-ride">
            <div class="history-ride-date">
                <span class="history-ride-day"><?= $date->format('d') ?></span>
                <span class="history-ride-month"><?= $date->format('M') ?></span>
            </div>

            <div class="history-ride-content">
                <div class="history-ride-route">
                    <div class="history-ride-dots">
                        <div class="history-ride-dot pickup"></div>
                        <div class="history-ride-line"></div>
                        <div class="history-ride-dot dropoff"></div>
                    </div>
                    <div class="history-ride-addresses">
                        <div class="history-ride-address"><?= htmlspecialchars($ride['pickup_address']) ?></div>
                        <div class="history-ride-address"><?= htmlspecialchars($ride['dropoff_address']) ?></div>
                    </div>
                </div>
                <div class="history-ride-meta">
                    <span><?= number_format($ride['distance'] ?? 0, 1) ?> km</span>
                    <span><?= $date->format('H:i') ?></span>
                </div>
            </div>

            <div class="history-ride-footer">
                <span class="history-ride-price"><?= number_format($ride['final_price'] ?? $ride['estimated_price'] ?? 0) ?> MAD</span>
                <span class="history-ride-status <?= $statusClass ?>"><?= __('ride.' . $ride['status']) ?></span>
            </div>
        </article>
        <?php endforeach; ?>
    </div>
    <?php else: ?>
    <div class="history-empty">
        <div class="history-empty-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
            </svg>
        </div>
        <h2 class="history-empty-title"><?= __('history.no_rides') ?></h2>
        <p class="history-empty-text"><?= __('history.no_rides_text') ?></p>
        <a href="<?= base_url('passenger/book') ?>" class="history-empty-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="16"/>
                <line x1="8" y1="12" x2="16" y2="12"/>
            </svg>
            <?= __('booking.title') ?>
        </a>
    </div>
    <?php endif; ?>
</div>
